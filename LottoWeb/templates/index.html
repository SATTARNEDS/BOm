<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lotto Pro VIP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="p-4">

<div class="container-fluid" style="max-width: 1400px;">
    
    <div class="navbar-custom d-flex flex-wrap align-items-center">
        <a class="nav-btn active" onclick="navTo('dashboard')"><i class="fas fa-chart-pie"></i> สรุปยอดหวย</a>
        <a class="nav-btn" onclick="navTo('keypad')"><i class="fas fa-keyboard"></i> คีย์ข้อมูล</a>
        <a class="nav-btn" onclick="navTo('settings')"><i class="fas fa-sliders-h"></i> ตั้งค่าตัดเก็บ</a>
        <a class="nav-btn" onclick="navTo('buyers')"><i class="fas fa-users"></i> ผู้ซื้อ/ส่วนลด</a>
        <a class="nav-btn" onclick="navTo('check')"><i class="fas fa-search"></i> ตรวจหวย</a>
        <a href="/logout" class="nav-btn logout ms-auto"><i class="fas fa-sign-out-alt"></i> ออกจากระบบ</a>
    </div>

    <div id="sec-dashboard" class="page-section active">
        <div class="card-custom mb-4">
            <div class="card-header-modern bg-gradient-success">
                <i class="fas fa-chart-line me-2"></i> สรุปยอดหวยออนไลน์
            </div>
            <div class="card-body p-4">
                <div class="table-responsive mb-4 rounded shadow-sm border">
                    <table class="table table-custom text-center mb-0">
                        <thead class="table-primary text-white">
                            <tr><th>2 ตัวบน</th><th>2 ตัวล่าง</th><th>วิ่งบน</th><th>วิ่งล่าง</th><th>3 ตัวบน</th><th>3 ตัวล่าง</th><th>3 ตัวโต๊ด</th></tr>
                        </thead>
                        <tbody id="dash-summary-row" class="fs-5 fw-bold text-dark bg-white"></tbody>
                    </table>
                    <div class="text-center py-3 bg-light border-top">
                        <span class="text-muted small text-uppercase fw-bold">ยอดรวมทั้งหมด</span>
                        <div class="fs-3 fw-bold text-primary" id="dash-total-sum">0</div>
                        <small class="text-muted">บาท</small>
                    </div>
                </div>
                
                <div class="d-flex justify-content-center mb-4">
                    <button class="btn btn-secondary px-4 rounded-pill" onclick="clearData()"><i class="fas fa-trash-alt me-2"></i> ล้างข้อมูลทั้งหมด</button>
                </div>

                <div class="row g-3 mb-4">
                    <div class="col-md-6">
                        <button onclick="openPopupReport('keep')" class="btn btn-shortcut btn-outline-success w-100 py-3">
                            <div class="d-flex align-items-center justify-content-center">
                                <div class="bg-success text-white rounded-circle p-3 me-3"><i class="fas fa-save fa-2x"></i></div>
                                <div class="text-start"><div class="fs-5 fw-bold">ดูรายการ "ตัดเก็บ"</div><small class="text-muted">Keep List</small></div>
                            </div>
                        </button>
                    </div>
                    <div class="col-md-6">
                        <button onclick="openPopupReport('send')" class="btn btn-shortcut btn-outline-danger w-100 py-3">
                            <div class="d-flex align-items-center justify-content-center">
                                <div class="bg-danger text-white rounded-circle p-3 me-3"><i class="fas fa-paper-plane fa-2x"></i></div>
                                <div class="text-start"><div class="fs-5 fw-bold">ดูรายการ "ตัดส่ง"</div><small class="text-muted">Send List</small></div>
                            </div>
                        </button>
                    </div>
                </div>

                <ul class="nav nav-tabs nav-tabs-custom mb-3" id="dashTabs">
                    <li class="nav-item"><button class="nav-link fw-bold text-secondary" onclick="renderTab('2digit')">สรุป 2 ตัว</button></li>
                    <li class="nav-item"><button class="nav-link active fw-bold text-primary" onclick="renderTab('3digit')">สรุป 3 ตัว (0-9)</button></li>
                    <li class="nav-item"><button class="nav-link fw-bold text-secondary" onclick="renderTab('running')">สรุปเลขวิ่ง</button></li>
                </ul>
                <div id="dash-content" class="bg-white p-3 border rounded-bottom"></div>
            </div>
        </div>
    </div>

    <div id="sec-keypad" class="page-section">
        <div class="row g-3">
            <div class="col-lg-5">
                <div class="card-custom h-100">
                    <div class="card-header-modern bg-gradient-primary text-white text-center">
                        <i class="fas fa-keyboard me-2"></i> คีย์ข้อมูลหวย
                    </div>
                    <div class="card-body p-4">
                        <ul class="nav nav-pills nav-fill mb-4 bg-light p-1 rounded-pill border">
                            <li class="nav-item"><button class="nav-link active rounded-pill fw-bold" data-bs-toggle="pill" data-bs-target="#kp-normal">ปกติ</button></li>
                            <li class="nav-item"><button class="nav-link rounded-pill fw-bold" data-bs-toggle="pill" data-bs-target="#kp-special">พิเศษ</button></li>
                            <li class="nav-item"><button class="nav-link rounded-pill fw-bold" data-bs-toggle="pill" data-bs-target="#kp-quick">เร็ว</button></li>
                        </ul>
                        
                        <div class="input-group mb-4">
                            <span class="input-group-text bg-light fw-bold"><i class="fas fa-user me-2"></i> ผู้ซื้อ</span>
                            <select id="k_buyer" class="form-select fw-bold text-primary"></select>
                        </div>

                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="kp-normal">
                                <div class="mb-4 text-center">
                                    <label class="form-label fw-bold text-muted text-uppercase small">ใส่ตัวเลข</label>
                                    <input type="text" id="n_num" class="form-control input-lg" maxlength="3" placeholder="---" oninput="validateNum(this)">
                                </div>
                                <div class="card bg-light border-0 mb-3 p-3">
                                    <div class="row g-2">
                                        <div class="col-4"><label class="small fw-bold text-center w-100 mb-1">บน</label><input type="number" id="n_top" class="form-control text-center fw-bold" placeholder="0"></div>
                                        <div class="col-4"><label class="small fw-bold text-center w-100 mb-1">ล่าง</label><input type="number" id="n_bot" class="form-control text-center fw-bold" placeholder="0"></div>
                                        <div class="col-4"><label class="small fw-bold text-center w-100 mb-1 text-warning">โต๊ด</label><input type="number" id="n_toad" class="form-control text-center fw-bold border-warning" placeholder="0"></div>
                                    </div>
                                </div>
                                <div class="card bg-light border-0 mb-4 p-3">
                                    <div class="row g-2">
                                        <div class="col-6"><label class="small fw-bold text-center w-100 mb-1">วิ่งบน</label><input type="number" id="n_rtop" class="form-control text-center fw-bold text-secondary" placeholder="0"></div>
                                        <div class="col-6"><label class="small fw-bold text-center w-100 mb-1">วิ่งล่าง</label><input type="number" id="n_rbot" class="form-control text-center fw-bold text-secondary" placeholder="0"></div>
                                    </div>
                                </div>
                                <button onclick="sendNormal()" class="btn btn-primary btn-action-lg w-100 shadow"><i class="fas fa-save me-2"></i> บันทึก (Enter)</button>
                            </div>

                            <div class="tab-pane fade" id="kp-special">
                                <form onsubmit="event.preventDefault(); sendSpecial();">
                                    <div class="mb-3">
                                        <label class="form-label small fw-bold">ประเภท</label>
                                        <select id="s_type" class="form-select">
                                            <option value="" selected disabled>-- กรุณาเลือก --</option>
                                            <option value="3_door">เลข 3 ประตู (3ตัว)</option>
                                            <option value="6_door">เลข 6 ประตู (3ตัว)</option>
                                            <option value="return_all">กลับทุกประตู</option>
                                            <hr>
                                            <option value="19_door">19 ประตู (2ตัว)</option>
                                            <option value="run_front">รูดหน้า</option>
                                            <option value="run_back">รูดหลัง</option>
                                        </select>
                                    </div>
                                    <div class="d-flex justify-content-center gap-3 mb-4 p-2 bg-light rounded">
                                        <div class="form-check"><input class="form-check-input checkbox-lg" type="checkbox" id="s_chk_top" checked><label class="form-check-label fw-bold">บน</label></div>
                                        <div class="form-check"><input class="form-check-input checkbox-lg" type="checkbox" id="s_chk_bot"><label class="form-check-label fw-bold">ล่าง</label></div>
                                        <div class="form-check"><input class="form-check-input checkbox-lg" type="checkbox" id="s_chk_toad"><label class="form-check-label fw-bold">โต๊ด</label></div>
                                    </div>
                                    <div class="mb-3"><label class="form-label small fw-bold">ตัวเลข</label><input type="text" id="s_num" class="form-control input-lg" style="height: 50px; font-size: 1.8rem;" oninput="validateNum(this)"></div>
                                    <div class="mb-4"><label class="form-label small fw-bold">ราคา</label><input type="number" id="s_amt" class="form-control text-center fw-bold fs-4"></div>
                                    <div class="d-flex gap-2"><button type="submit" class="btn btn-success btn-action-lg flex-grow-1"><i class="fas fa-check"></i> ตกลง</button><button type="button" class="btn btn-outline-secondary btn-action-lg" onclick="document.querySelector('form').reset()">รีเซ็ต</button></div>
                                </form>
                            </div>

                            <div class="tab-pane fade" id="kp-quick">
                                <div class="alert alert-secondary small mb-3 border-0"><i class="fas fa-info-circle me-1"></i> <strong>รูปแบบ:</strong><br>123 100 20 20 (บน โต๊ด ล่าง)<br>12 100 100 (บน ล่าง)</div>
                                <textarea id="q_text" class="form-control bg-dark text-white mb-3 font-monospace" rows="8" placeholder="พิมพ์รายการที่นี่..."></textarea>
                                <button onclick="sendQuick()" class="btn btn-warning btn-action-lg w-100 text-dark"><i class="fas fa-bolt me-2"></i> ประมวลผล</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-7">
                <div class="card-custom h-100">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center p-3 border-bottom">
                        <div class="d-flex align-items-center">
                            <div class="bg-light rounded-circle p-2 me-2"><i class="fas fa-history text-primary"></i></div>
                            <span class="fw-bold">รายการล่าสุด</span>
                        </div>
                        <div class="d-flex gap-2">
                            <button class="btn btn-sm btn-outline-primary fw-bold" onclick="openViewAll()"><i class="fas fa-list-alt me-1"></i> ดูทั้งหมด</button>
                            <button class="btn btn-sm btn-outline-danger fw-bold" onclick="deleteSelected()"><i class="fas fa-trash me-1"></i> ลบที่เลือก</button>
                        </div>
                    </div>
                    <div class="table-responsive" style="height: 600px;">
                        <table class="table table-hover table-custom mb-0 small align-middle">
                            <thead class="sticky-top table-dark" style="z-index: 5;">
                                <tr>
                                    <th width="40" class="text-center"><input class="form-check-input" type="checkbox" onchange="toggleAll(this)"></th>
                                    <th>เวลา</th><th>ผู้ซื้อ</th><th class="text-center">เลข</th><th class="text-center">ประเภท</th><th class="text-end pe-3">บาท</th><th class="text-center">ลบ</th>
                                </tr>
                            </thead>
                            <tbody id="recentBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="sec-settings" class="page-section">
        <div class="card-custom">
            <div class="card-header-modern bg-secondary text-white"><i class="fas fa-cog me-2"></i> ตั้งค่าตัดเก็บรายตัว</div>
            <div class="card-body p-5">
                <div class="alert alert-light border-start border-4 border-info shadow-sm mb-4"><i class="fas fa-info-circle text-info me-2"></i> ใส่ <strong>0</strong> หมายถึงเก็บหมด (ไม่อั้น)</div>
                <form id="settingsForm" class="mx-auto" style="max-width: 600px;">
                    <div class="row g-3 align-items-center mb-2"><div class="col-4 text-end fw-bold">สามตัวบน</div><div class="col-8"><input type="number" name="limit_3top" class="form-control text-center" placeholder="0"></div></div>
                    <div class="row g-3 align-items-center mb-2"><div class="col-4 text-end fw-bold">สามตัวล่าง</div><div class="col-8"><input type="number" name="limit_3bottom" class="form-control text-center" placeholder="0"></div></div>
                    <div class="row g-3 align-items-center mb-2"><div class="col-4 text-end fw-bold">สามตัวโต๊ด</div><div class="col-8"><input type="number" name="limit_3toad" class="form-control text-center" placeholder="0"></div></div>
                    <div class="row g-3 align-items-center mb-2"><div class="col-4 text-end fw-bold">สามตัววิ่ง</div><div class="col-8"><input type="number" name="limit_run_top" class="form-control text-center" placeholder="0"></div></div>
                    <hr class="my-4 text-muted">
                    <div class="row g-3 align-items-center mb-2"><div class="col-4 text-end fw-bold">สองตัวบน</div><div class="col-8"><input type="number" name="limit_2top" class="form-control text-center" value="2000"></div></div>
                    <div class="row g-3 align-items-center mb-2"><div class="col-4 text-end fw-bold">สองตัวล่าง</div><div class="col-8"><input type="number" name="limit_2bottom" class="form-control text-center" value="2000"></div></div>
                    <hr class="my-4 text-muted">
                    <div class="row g-3 align-items-center mb-2"><div class="col-4 text-end fw-bold">วิ่งสองตัวบน</div><div class="col-8"><input type="number" class="form-control text-center" placeholder="0" disabled></div></div>
                    <div class="row g-3 align-items-center mb-2"><div class="col-4 text-end fw-bold">วิ่งสองตัวล่าง</div><div class="col-8"><input type="number" name="limit_run_bottom" class="form-control text-center" placeholder="0"></div></div>
                    <div class="text-center mt-4"><button type="button" onclick="saveSettings()" class="btn btn-success btn-lg px-5 shadow"><i class="fas fa-save me-2"></i> บันทึกค่า</button></div>
                </form>
            </div>
        </div>
    </div>

    <div id="sec-buyers" class="page-section">
        <div class="card-custom">
            <div class="card-header-modern bg-info text-white d-flex justify-content-between align-items-center"><span><i class="fas fa-users me-2"></i> ผู้ซื้อ / คนเดินโพย</span></div>
            <div class="card-body p-0">
                <table class="table table-hover table-bordered mb-0 align-middle text-center">
                    <thead class="table-info text-dark"><tr><th>ชื่อ</th><th>ยอดซื้อรวม</th><th width="100">% ส่วนลด</th><th>ยอดส่วนลด</th><th>ยอดสุทธิ</th><th>จัดการ</th></tr></thead>
                    <tbody id="buyerBody"></tbody>
                    <tfoot class="bg-light"><tr><td colspan="6" class="p-3"><button class="btn btn-success rounded-pill px-4" onclick="addBuyer()"><i class="fas fa-plus me-1"></i> เพิ่มผู้ซื้อใหม่</button></td></tr></tfoot>
                </table>
            </div>
        </div>
    </div>

    <div id="sec-check" class="page-section">
        <div class="row g-4">
            <div class="col-md-4">
                <div class="card-custom p-4 text-center">
                    <h5 class="fw-bold mb-4 text-primary"><i class="fas fa-search me-2"></i> ตรวจรางวัล</h5>
                    <div class="mb-3 text-start"><label class="form-label fw-bold">3 ตัวบน</label><input type="text" id="chk_top3" class="form-control form-control-lg text-center fw-bold text-danger"></div>
                    <div class="mb-4 text-start"><label class="form-label fw-bold">2 ตัวล่าง</label><input type="text" id="chk_bot2" class="form-control form-control-lg text-center fw-bold text-danger"></div>
                    <button onclick="doCheck()" class="btn btn-primary w-100 btn-lg shadow"><i class="fas fa-search me-2"></i> ตรวจสอบ</button>
                </div>
            </div>
            <div class="col-md-8">
                <div class="card-custom p-4 h-100 border-start border-4 border-primary">
                    <h5 class="fw-bold mb-3 text-dark">ผลการตรวจ</h5>
                    <div id="checkResult" class="fs-5"></div>
                </div>
            </div>
        </div>
    </div>

</div>

<div class="modal fade" id="reportPopupModal" tabindex="-1">
    <div class="modal-dialog modal-wide"> 
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header text-white" id="popupHeader"><h5 class="modal-title fw-bold" id="popupTitle">รายละเอียด</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
            <div class="modal-body bg-light">
                <ul class="nav nav-pills nav-fill mb-3 bg-white p-2 rounded shadow-sm" id="popupTabs">
                    <li class="nav-item"><button class="nav-link active fw-bold" onclick="renderPopup('3digit')">3 ตัว</button></li>
                    <li class="nav-item"><button class="nav-link fw-bold" onclick="renderPopup('2digit')">2 ตัว</button></li>
                    <li class="nav-item"><button class="nav-link fw-bold" onclick="renderPopup('running')">วิ่ง</button></li>
                </ul>
                <div id="popupContent"></div>
            </div>
            <div class="modal-footer bg-white"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ปิด</button><button type="button" class="btn btn-primary" onclick="window.print()"><i class="fas fa-print me-1"></i> พิมพ์</button></div>
        </div>
    </div>
</div>

<div class="modal fade" id="viewAllModal" tabindex="-1">
    <div class="modal-dialog modal-wide modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white"><h5 class="modal-title"><i class="fas fa-list me-2"></i> รายการทั้งหมด (500 ล่าสุด)</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
            <div class="modal-body p-0">
                <div class="p-2 bg-light border-bottom d-flex justify-content-end sticky-top"><button class="btn btn-sm btn-outline-danger" onclick="deleteFromModal()"><i class="fas fa-trash-alt me-1"></i> ลบรายการที่เลือก</button></div>
                <table class="table table-striped table-hover text-center align-middle mb-0 small"><thead class="table-secondary sticky-top" style="top: 0px;"><tr><th width="50"><input type="checkbox" onchange="toggleAllModal(this)"></th><th>เวลา</th><th>ผู้ซื้อ</th><th>เลข</th><th>ประเภท</th><th>บาท</th><th>ลบ</th></tr></thead><tbody id="viewAllBody"></tbody></table>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="manageBuyerModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white"><h5 class="modal-title" id="manageBuyerTitle">จัดการผู้ซื้อ</h5><button class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
            <div class="modal-body"><input type="hidden" id="mb_id"><div class="mb-3"><label class="fw-bold">ชื่อผู้ซื้อ</label><input type="text" id="mb_name" class="form-control" placeholder="ชื่อเล่น หรือ รหัส"></div><div class="mb-3"><label class="fw-bold">% ส่วนลด</label><input type="number" id="mb_discount" class="form-control" placeholder="0"></div></div>
            <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button><button type="button" class="btn btn-primary" onclick="saveBuyerData()">บันทึก</button></div>
        </div>
    </div>
</div>

<div class="modal fade" id="buyerModal" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header bg-info text-white"><h5 class="modal-title" id="modalTitle"></h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body p-0"><table class="table table-striped text-center mb-0"><thead><tr><th>ประเภท</th><th>เลข</th><th>เงิน</th></tr></thead><tbody id="buyerDetailBody"></tbody></table></div></div></div></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='js/script.js') }}"></script>

</body>
</html>